#include <iostream>
#include <stack>
#include <string>
#include <map>
#include <vector>
#include <algorithm>
using namespace std;
map<int, int> getMaxValueIndexMemo;
map<int, int> getMaxProfitMemo;
int getMaxValueIndex(const vector<int> &prices, const int startIndex){
    if(getMaxValueIndexMemo.find(startIndex)==getMaxValueIndexMemo.end()){
//cout<<"In getMaxValueIndex(prices[], "<<startIndex<<")\n";
        int nDays = prices.size(); int resultIndex;
        if(startIndex >= nDays || startIndex<0){
            resultIndex = -1;
        }else if(startIndex == nDays-1){
            resultIndex = startIndex;
        }else{
            int prevMaxValueIndex = getMaxValueIndex(prices, startIndex+1);
            int prevMaxValue = prices[prevMaxValueIndex], curValue = prices[startIndex];
            resultIndex = curValue > prevMaxValue ? startIndex : prevMaxValueIndex;
        }
        getMaxValueIndexMemo[startIndex] = resultIndex;
    }
    return getMaxValueIndexMemo[startIndex];
}
int getMaxProfit(const vector<int> &prices, const int startIndex){
    if(getMaxProfitMemo.find(startIndex) == getMaxProfitMemo.end()){
//cout<<"In getMaxProfit(prices[], "<<startIndex<<")"<<endl;
        int maxP = INT_MIN, nDays = prices.size();
        for(int i=startIndex; i<nDays-1; i++){
            int buyDayIndex = i, sellDayIndex = getMaxValueIndex(prices, i+1);
            int curP = prices[sellDayIndex] - prices[buyDayIndex];
            maxP = max(maxP, curP);
        }
        getMaxProfitMemo[startIndex] = maxP;
    }
    return getMaxProfitMemo[startIndex];
}
int _maxProfit(const vector<int> &prices){
//cout<<"In _maxProfit"<<endl;
    int mP = 0, nDays = prices.size();
    if(nDays==2){
        int t1P = prices[1] - prices[0];
        return t1P > 0?t1P:0;
    }
    if(nDays==3){
        int t1P = prices[1] - prices[0];
        int t2P = prices[2] - prices[1];
        int t3P = prices[2] - prices[0];
        if(t1P > 0 || t2P > 0 || t3P > 0){
            return max(t3P, max(t1P, t2P));
        }
        return 0;
    }
    for(int bi1=0; bi1<nDays-3; bi1++){
        for(int si1=bi1+1; si1<nDays-2; si1++){
            int t1p = prices[si1] - prices[bi1];
            int startIndexForTransaction2 = si1+1;
            int t2p = getMaxProfit(prices, startIndexForTransaction2);
            int cP = max(0, t1p) + max(0, t2p);
            mP = max(cP, mP);
        }
    }
    return mP;
}
//int Solution::maxProfit(const vector<int> &prices) {
int maxProfit(const vector<int> &prices) {
    getMaxValueIndexMemo.clear();
    getMaxProfitMemo.clear();

    return _maxProfit(prices);
}
int main()
{
    int arr2[] = {1,2, 1};
    vector<int> r2(arr2, arr2+sizeof(arr2)/sizeof(arr2[0]));
    cout <<1<<','<<maxProfit(r2) << endl;

    int arr3[] = {1,2,1,2};
    vector<int> r3(arr3, arr3+sizeof(arr3)/sizeof(arr3[0]));
    cout <<2<<','<<maxProfit(r3) << endl;

    int arr5[] = {1816026, 4445866, 8263009, 3337498, 7630892, 8723492, 5743063, 7460506, 5710048, 85108, 8838540, 1097349, 7547825, 8319859, 5169249, 7876668, 2377204, 2018968, 9496202, 6949488, 4411150, 3870381, 5370710, 3849187, 5363251, 5466063, 2407296, 1421265, 9361858, 5236558, 9224750, 7897738, 3837041, 8137331, 1553282, 4665912, 5911989, 6678553, 9991580, 7848277, 378852, 2569333, 5157178, 5649991, 5606074, 433803, 9961638, 7314143, 4989309, 3546341, 9507638, 2745595, 5891229, 3763058, 408470, 5699811, 3108783, 6411502, 3281126, 2353633, 4909334, 2966922, 2670241, 9060572, 5452812, 1036353, 4438565, 6801091, 487462, 3047948, 5775287, 1216070, 4634216, 5395224, 6893259, 3588096, 5501507, 2448640, 3465570, 185220, 5803291, 633274, 4593469, 265969, 1164679, 8149927, 8920138, 6934726, 8209601, 4764238, 5118907, 176675, 6638027, 1541566, 8645385, 2734960, 1568729, 6389248, 2996510, 7960127, 5397974, 4156602, 8365752, 5062010, 6941788, 9718074, 272742, 7490827, 570013, 7928507, 9927475, 3314712, 3978636, 3056397, 3916067, 3215235, 8840085, 1103763, 9086237, 1015295, 4672837, 1379578, 5137244, 9913858, 3176836, 7863864, 9200199, 880197, 8120580, 1056568, 5493236, 798559, 2175691, 5018652, 5283280, 5101316, 6900675, 7485975, 2281846, 8214076, 5641460, 5909067, 8372937, 3862104, 9788848, 8641706, 545907, 8390081, 1645177, 3527558, 8665823, 4038538, 8281957, 4172409, 7711081, 4471082, 3191425, 9887606, 3058443, 3109828, 1071532, 7852421, 444771, 4920392, 8168110, 7339239, 1111834, 6957594, 9494923, 3728030, 5438041, 4676758, 8348137, 461767, 5796496, 4170255, 2073574, 6872437, 6039293, 2384509, 7875427, 5620933, 3729263, 4908310, 4958906, 187264, 3306132, 1376673, 438347, 6240417, 1926029, 5844282, 1907457, 6289278, 9835994, 754174, 5430030, 484221, 3413718, 8622912, 5952161, 1996733, 1016954, 9560144, 9363109, 5727954, 5242092, 338101, 2744261, 2341157, 6471594, 3271489, 8782508, 6734611, 6663657, 3728963, 8472790, 691497, 8549746, 8952332, 5944600, 1149691, 2538920, 8008148, 1744019, 8263940, 7088237, 6512804, 4549298, 6398405, 3159869, 857775, 5074000, 145612, 1419290, 5130721, 7635627, 5192684, 4504906, 1849389, 7375605, 651440, 6913897, 2703610, 2981417, 7232776, 3513679, 3381692, 8225742, 3050494, 3310935, 5575520, 7121439, 7890372, 2522256, 404455, 1841596, 6785382, 1094915, 5246170, 4775827, 1915011, 247056, 7395134, 6739069, 1380593, 3062392, 9511274, 4831544, 8761472, 7362857, 5242070, 5572640, 7974463, 9848545, 5909682, 458767, 9826038, 4755508, 4299381, 1010670, 3766913, 6979585, 6451442, 1317470, 1085919, 9654706, 5308485, 6794129, 7989289, 360910, 7194013, 3804139, 7296497, 4024092, 4272691, 8994444, 1933994, 1848265, 3585675, 1754648, 5450492, 3615591, 7339652, 3958694, 3649362, 4240800, 2615745, 8346532, 2657882, 7248449, 791312, 3726984, 2130404, 9189918, 4379732, 5828108, 7910605, 5635369, 4869449, 2386912, 4671369, 8874150, 9183625, 6446047, 9661229, 784492, 3204469, 7423394, 900408, 2373800, 6766135, 8709546, 7172402, 9464952, 4253747, 6655287, 1304860, 7756250, 8580082, 6673191, 6164739, 9386020, 8742683, 7457515, 6416019, 5220348, 1025181, 4596150, 4815593, 9341233, 6486585, 1664535, 8048779, 6347692, 3171467, 6055616, 76752, 7300335, 7995193, 9319155, 9160395, 4479005, 3388378, 9320353, 3095115, 7258217, 5907166, 2506455, 7267811, 9738077, 1386213, 6713290, 7167890, 3631775, 3733037, 1278596, 9185700, 8951445, 9164042, 6927884, 5413972, 775495, 8222578, 1413622, 1084022, 7385115, 3868607, 4517780, 9198389, 3964973, 9769493, 3047759, 6361309, 7643439, 7734932, 2602786, 2054502, 1289840, 6057956, 6169960, 788244, 7890630, 3095917, 7416429, 2446244, 3730161, 2554954, 9867466, 2668920, 689466, 4353120, 138131, 817881, 419566, 588181, 6366171, 5257851, 9201798, 7846809, 4693084, 7994161, 7106078, 8680756, 9940528, 9584517, 4751815, 6031073, 6815552, 4337898, 6554686, 3714971, 7968468, 2086093, 925352, 3062599, 6287103, 5981782, 5324682, 9102913, 1141749, 95054, 4723965, 9969188, 8510467, 6924277, 6571265, 160342, 6904963, 5552174, 1602308, 9590906, 2463613, 960713, 8117688, 5268180, 8467188, 6336420, 6245939, 4316556, 7534625, 1427956, 4991040, 7949054, 988385, 3077721, 5482056, 225917, 2437099, 6592720, 4191933, 9558632, 5375351, 2654899, 796668, 866204, 8784210, 6138166, 7525467, 8368728, 2292795, 2583223, 4806448, 1871905, 6329355, 322340, 286679, 4020037, 7188237, 8390612, 8495064, 9531724, 5950091, 889742, 439955, 417616, 8766018, 980629, 5393043, 5670218, 2890828, 5894753, 467963, 9754605, 2229397, 2400334, 5920805, 7464622, 645778, 1691060, 5960042, 566918, 3836217, 2894943, 6627025, 430907, 4640180, 6104709, 615743, 5321392, 6779172, 3015740, 5941127, 378859, 8236446, 7225088, 9765108, 146721, 1095566, 4818325, 1009688, 8385588, 8120526, 1542411, 7770382, 9927522, 1342019, 298702, 3506009, 2274161, 7683093, 7760309, 863509, 5895865, 8328693, 4796028, 7688077, 1348335, 8820828, 1871324, 6571272, 634097, 3054218, 6348524, 2937235, 6391283, 4884457, 8364668, 3135508, 4301552, 7946991, 3730979, 9004089, 1784810, 7484312, 151545, 128505, 9303990, 2563347, 7840484, 4564663, 6596123, 3197287, 7219082, 927908, 4566254, 278941, 3016001, 6527817, 2127733, 7711647, 276127, 8244065, 8629218, 5915082, 6231863, 9288502, 6614873, 5449443, 8655451, 8446155, 1023685, 4523014, 5122197, 1702372, 7922555, 4993357, 6031607, 5790489, 4782090, 8300389, 134845, 9297801, 9318659, 2542647, 6351127, 7134179, 6578508, 2071484, 112724, 3121266, 1173737, 5163357, 6597151, 6643942, 4932951, 6724245, 2503924, 192929, 9966028, 6910214, 4100216, 7040241, 6934047, 5250395, 9143788, 6967267, 4677806, 5311271, 3851308, 9439421, 7081853, 432294, 2966791, 3758522, 8149916, 4965933, 5325147, 7986091, 3376961, 848074, 6657899, 4075204, 3784536, 2395886, 2029321, 5518856, 9963044, 9404312, 1934421, 1191704, 3629253, 7312969, 9003001, 4922826, 8628017, 3323361, 9582030, 9190266, 81123, 4053722, 336471, 93884, 6066483, 643773, 9718336, 6634365, 3849104, 6258345, 8938409, 602170, 9753964, 3739797, 9970822, 2614709, 4464144, 8812934, 8576889, 7551203, 3816919, 2476650, 7016435, 9264164, 1249643, 5629793, 5015175, 2959578, 7127624, 2848362, 4483057, 8789326, 2331431, 4314317, 2426712, 8040439, 4667464, 3389871, 5156022, 9990429, 1081601, 8598732, 5851226, 3808611, 7767192, 8565880, 9821949, 2207535, 4849296, 2785210, 5586236, 5027379, 4333861, 8650005, 2457922, 9143026, 5793420, 4553341, 5773129, 3344485, 4938165, 1415259, 2660900, 8838015, 2629781, 719897, 7703463, 2487988, 6598479, 7987933, 2377263, 6926959, 7724474, 2802379, 9130286, 7995155, 3339687, 203756, 5882779, 8478145, 2240227, 5991600, 9120424, 5565538, 1551835, 4882554, 5607520, 5006997, 6905367, 500453, 7409674, 2923963, 2346315, 104975, 2472901, 4989484, 1232596, 7432978, 2605060, 1697646, 8965228, 311743, 3901442, 1685368, 7740648, 4012390, 2674113, 4671428, 6158047, 3205871, 7837469, 2289480, 1263731, 4991354, 4828534, 7367974, 7559985, 4774371, 4533956};
    vector<int> r5(arr5, arr5+sizeof(arr5)/sizeof(arr5[0]));
    cout <<19820149<<","<<maxProfit(r5)<< endl;


    int arr4[] = { 4194445, 5755801, 2855639, 4681951, 642183, 9606207, 6539770, 2929563, 2371075, 2065991, 4734767, 3035028, 9844237, 9859030, 5366228, 7126800, 3093826, 2064333, 4794134, 6009455, 1554282, 1141024, 9008908, 5564577, 5670584, 3701388, 305389, 9988838, 7607445, 8689404, 4606240, 721493, 8358372, 7969247, 2005188, 9381407, 9640526, 1257732, 3128856, 5674956, 7212588, 5699639, 3391536, 9223297, 303612, 246025, 4664705, 5533721, 1254106, 6723049, 7092956, 9115027, 4029515, 8682821, 3075505, 2455402, 8685967, 7823073, 8138079, 5223844, 7204268, 8388370, 4932424, 1163737, 5251626, 5026560, 5050075, 444693, 8416089, 6533127, 8849938, 9195466, 6912747, 318446, 2255659, 1324379, 1091239, 7558075, 9314612, 7170906, 3222755, 3626629, 184898, 4602309, 1596067, 2979905, 5350257, 2919884, 9904801, 722970, 8136001, 1391045, 6414844, 2205953, 4755182, 2798289, 5134693, 9826047, 432014, 6805799, 6827969, 7032606, 4696237, 5731657, 2733376, 4768391, 2782129, 4632527, 4485247, 9064703, 3372660, 9420437, 4193640, 2612882, 2867493, 8068152, 3907859, 124864, 5942858, 5168681, 5242568, 474474, 8675032, 1368145, 5358739, 4107643, 1657155, 9175880, 8535311, 8277280, 7462655, 5984330, 7676367, 498783, 9495820, 3076391, 3546466, 3806366, 1312460, 652185, 9729605, 2472157, 913603, 78321, 7611113, 6599149, 4055264, 8831043, 2431665, 6773353, 262124, 8150637, 3198010, 9990139, 811941, 7829764, 5725450, 223476, 4615776, 9894103, 5906398, 906269, 3967342, 1543460, 4301996, 1787414, 8254232, 1789655, 4230800, 5969792, 905489, 3258010, 9454136, 4249389, 6467504, 6519664, 4001349, 5026632, 5014202, 6667981, 3817855, 5034444, 6930070, 1349637, 1035425, 9252606, 6607642, 2524617, 1006652, 3528601, 2690079, 9721966, 4199938, 5762348, 128435, 4118901, 6892353, 2989545, 666501, 5888056, 8654317, 4248490, 762635, 5111086, 5764247, 1866872, 4293692, 9257206, 6891118, 6087668, 941907, 8810109, 6646582, 3630739, 446420, 351840, 4011717, 3143139, 7749114, 6392659, 9048202, 7016084, 2382421, 4446109, 8485561, 5782000, 3949229, 5221723, 8561121, 9303285, 1543066, 6108565, 2722519, 7758442, 6163843, 2755475, 1023498, 5443927, 312752, 9196009, 3221496, 2914945, 2653161, 4489388, 1959263, 5623432, 9971827, 3785009, 7319090, 7630374, 5217607, 8044924, 8769872, 8185537, 1597610, 7814177, 1029537, 7567770, 2258460, 5576548, 482655, 2612813, 3224455, 2585241, 1092094, 9877649, 7498080, 5699558, 2951043, 6086409, 9542232, 661452, 5836164, 4345098, 8307895, 6637498, 6272548, 6046123, 3646645, 774039, 2892326, 8990224, 7423970, 1974660, 2915143, 3225108, 7089874, 6573037, 562334, 4269980, 489996, 1186345, 8226531, 816581, 768322, 8850738, 4660865, 816794, 6128349, 9412437, 8816780, 8379353, 3537553, 4864852, 5573468, 79518, 6575334, 7596536, 6889113, 9602795, 6640332, 2332107, 6535110, 7488014, 9995147, 3170250, 5091560, 1360125, 7509497, 1121503, 7358828, 4794661, 7027205, 3332651, 9573810, 4093855, 7576965, 2998873, 7914729, 1092664, 1802541, 8724368, 558214, 2857902, 2716188, 2003935, 7168482, 6012254, 3643378, 6074238, 6647950, 6389831, 5109285, 866253, 381182, 1164871, 6275734, 1373355, 7017631, 5325732, 255703, 8151488, 9133852, 5909110, 3275900, 6061125, 475435, 3611189, 2999139, 4638073, 8973840, 2561265, 3769187, 6653732, 8312926, 8824383, 1472759, 4821429, 1483913, 862658, 5331434, 5223163, 9257756, 1027441, 4445934, 8306958, 9852026, 203971, 5610515, 9554829, 2882366, 5159575, 5463819, 2912256, 1762629, 2822314, 1863502, 3884780, 3574742, 8568504, 1253111, 503241, 6109333, 7496262, 7489733, 4319399, 9349740, 3945259, 8884655, 7607110, 8608523, 4386536, 9292660, 9617100, 5400748, 5880352, 8878708, 4242669, 7471856, 7150688, 9502486, 3485539, 2421557, 1965130, 7403648, 8796538, 6717060, 259999, 6321534, 2791184, 4094667, 4931963, 1782625, 497135, 931841, 7789116, 9062312, 1314376, 4186203, 2781984, 6351555, 6433207, 5584677, 6332921, 1563685, 1553136, 2297922, 8427601, 1826430, 3253257, 1884767, 5263589, 7242437, 4136563, 2669239, 4890360, 7994097, 3243588, 3024004, 6227582, 4667341, 5951200, 7625344, 5601489, 525262, 9273359, 6532814, 5958471, 4875336, 1980311, 2047533, 1693741, 5059206, 1441267, 8561945, 9413927, 267932, 9767893, 5708235, 8490874, 5875232, 4514791, 122809, 8169308, 5485225, 1258832, 6423197, 7401453, 63428, 6242952, 3935999, 5627757, 7677399, 7549112, 7071403, 1269499, 6408877, 4263892, 2386645, 2142089, 9680907, 8958646, 787007, 7100373, 3563871, 9002573, 369222, 2707131, 9279796, 2847105, 7396262, 8662258, 2403065, 8174614, 5792694, 6292058, 3741998, 2806982, 9193909, 4390354, 5450971, 9800176, 9442318, 848643, 3667121, 6013064, 7078994, 864441, 2124755, 987795, 3904413, 4436411, 3207605, 4372015, 400985, 3196209, 8094432, 1053017, 710448, 349168, 6789123, 7444730, 3441905, 3933247, 6882550, 6867729, 9164628, 165786, 716556, 1109737, 3671507, 6671443, 1236642, 1664765, 9329820, 5442137, 6931445, 3808660, 2034565, 8492007, 1031792, 2348823, 7364453, 4999931, 4322960, 8340199, 639089, 135093, 4657084, 8368461, 8517539, 6231696, 8261869, 8247731, 7867767, 7266041, 6158750, 7335486, 8035170, 4269642, 7393800, 7019543, 4434206, 3330723, 6580929, 4449142, 8067766, 3682033, 3698348, 3067274, 9752295, 1121939, 7713186, 1157402, 2462787, 8355113, 3140410, 3159795, 1928352, 5335266, 5919865, 505504, 2750149, 2786405, 2165156, 7275716, 2443565, 7820731, 3257234, 3943777, 3295474, 173055, 6809788, 6093159, 264240, 3204306, 9165393, 6552803, 8654172, 2492684, 2467027, 126724, 6043336, 3988090, 1145326, 9919194, 4786559, 1544896, 9566382, 6783344, 9457825, 8712145, 5598821, 2627075, 7848949, 4073282, 5164981, 5966346, 4412603, 7695179, 9612711, 3863295, 6957529, 7419982, 7950638, 9746913, 8971977, 6977344, 7509979};
    vector<int> r4(arr4, arr4+sizeof(arr4)/sizeof(arr4[0]));
    cout <<19827447<<','<<maxProfit(r4) << endl;
    return 0;
}
